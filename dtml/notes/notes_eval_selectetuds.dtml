<dtml-var "sco_header(page_title='Saisie des notes',REQUEST=REQUEST)">
<h2>Saisie des notes</h2>

<dtml-unless notesfile-submitted>

<p>
<dtml-var "do_evaluation_selectetuds(REQUEST)">
</p>

</dtml-unless>
<dtml-let eval="do_evaluation_list( {'evaluation_id' : evaluation_id})[0]">

<div class="saisienote_etape2">
<span class="titredivsaisienote">Etape 2 : chargement d'un fichier de notes</span>
<dtml-call "REQUEST.set('nf', TrivialFormulator( URL0, REQUEST.form, 
  ( 
    ('evaluation_id', { 'default' : evaluation_id, 'input_type' : 'hidden' }),
    ('notefile',  { 'input_type' : 'file', 'title' : 'Fichier de note (.xls)', 'size' : 44 }),
    ('comment', { 'size' : 44, 'title' : 'Commentaire',
	'explanation':'(note: la colonne remarque du fichier excel est ignorée)' }),
   ),
   formid='notesfile',
   submitlabel = 'Télécharger'))">

<dtml-if "nf[0] == 0">
<p>Le fichier doit être un fichier tableur obtenu via le formulaire ci-dessus, puis complété et enregistré au format Excel.
</p>
 <dtml-var "nf[1]">
<dtml-elif "nf[0] == -1">
   Annulation
<dtml-elif "nf[0] == 1">
   <dtml-let updiag="do_evaluation_upload_xls(REQUEST)">
    <dtml-if "updiag[0]">
      <p>Notes chargées. 
      <a class="stdlink" href="moduleimpl_status?moduleimpl_id=<dtml-var "eval['moduleimpl_id']">">
      Continuer</a>
      </p>
    <dtml-else>
      <p class="redboldtext">Notes non chargées !</p>
      <p><a class="stdlink" href="notes_eval_selectetuds?evaluation_id=<dtml-var "eval['evaluation_id']">">
        Reprendre</a>
      </p>
    </dtml-if>
   </dtml-let>
</dtml-if>

</div>

<h3>Autres opérations</h3>

<ul>
<dtml-if "can_edit_notes(AUTHENTICATED_USER,eval['moduleimpl_id'],allow_ens=False)">

<li>
<form action="do_evaluation_set_missing" method="GET">
Mettre toutes les notes manquantes à <input type="text" size="5" name="value"/>
<input type="submit" value="OK"/> 
<input type="hidden" name="evaluation_id" value="<dtml-var evaluation_id>"/> 
<em>ABS indique "absent" (zéro), EXC "excusé" (neutralisées), ATT "attente"</em>
</form>
</li>

<li><a class="stdlink" href="evaluation_suppress_alln?evaluation_id=<dtml-var evaluation_id>">Effacer toutes les notes de cette évaluation</a> (ceci permet ensuite de supprimer l'évaluation si besoin)
</li> 
</dtml-if>
<li><a class="stdlink" href="moduleimpl_status?moduleimpl_id=<dtml-var "eval['moduleimpl_id']">">Revenir au module</a>
</li>
</ul>

<h3>Explications</h3>
<ol>
<li>Cadre bleu (étape 1): 
<ol><li>choisir la méthode de saisie (formulaire web ou feuille Excel);
    <li>choisir le ou les groupes;</li>
</ol>
</li>
<li>Cadre vert (étape 2): à n'utiliser que si l'on est passé par une feuille Excel. Indiquer le fichier Excel <em>téléchargé à l'étape 1</em> et dans lequel on a saisi des notes. Remarques:
<ul>
<li>le fichier Excel ne doit pas forcément être complet: on peut ne saisir que quelques notes et répéter l'opération (en téléchargeant un nouveau fichier) plus tard;</li>
<li>seules les valeurs des notes modifiées sont prises en compte;</li>
<li>seules les notes sont extraites du fichier Excel;</li>
<li>on peut optionnellement ajouter un commentaire (type "copies corrigées par Dupont", ou "Modif. suite à contestation") dans la case "Commentaire".
</li>
<li>le fichier Excel <em>doit impérativement être celui chargé à l'étape 1 pour cette évaluation</em>. Il n'est pas possible d'utiliser une liste d'appel ou autre document Excel téléchargé d'une autre page.</li>
</ul>
</li>
</ol>

</dtml-let eval>
<dtml-var sco_footer>
